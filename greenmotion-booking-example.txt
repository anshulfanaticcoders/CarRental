GreenMotion Booking Example (USD provider, EUR admin, INR customer)

Assumptions
- Provider currency (GreenMotion response): USD
- Provider grand total: 100.00 USD
- Deposit percentage: 15%
- Example FX rates at booking time:
  - 1 USD = 0.92 EUR
  - 1 USD = 83.00 INR

1) Search -> Vehicle selection (provider currency)
- GetVehicles returns vehicles + packages in USD.
- optionalextras return in USD.
- Customer selects package + extras.

Provider totals (USD)
- Provider grand total: 100.00 USD
- Provider deposit (15%): 15.00 USD
- Provider due at pickup: 85.00 USD

2) Checkout -> Stripe (customer currency INR)
Server recomputes totals and converts to booking currency (INR).

Converted booking totals (INR)
- Total: 100.00 USD x 83.00 = 8,300.00 INR
- Deposit: 15.00 USD x 83.00 = 1,245.00 INR
- Pending: 85.00 USD x 83.00 = 7,055.00 INR

Stripe Checkout is created for the deposit only (INR 1,245.00).

3) Booking saved in DB

bookings (customer-facing currency: INR)
- booking_currency: INR
- total_amount: 8300.00
- amount_paid: 1245.00 (deposit)
- pending_amount: 7055.00
- provider_source: greenmotion
- provider_vehicle_id: GreenMotion vehicle id
- provider_metadata: provider totals in USD + extras + location info
- stripe_session_id, stripe_payment_intent_id
- payment_status: partial
- booking_status: confirmed

booking_payments (Stripe deposit)
- amount: 1245.00
- currency: INR
- payment_method: stripe
- payment_status: succeeded

booking_amounts (multi-currency snapshots)

Booking currency snapshot (INR)
- booking_currency: INR
- booking_total_amount: 8300.00
- booking_paid_amount: 1245.00
- booking_pending_amount: 7055.00

Admin currency snapshot (EUR)
- Total: 100.00 USD x 0.92 = 92.00 EUR
- Deposit: 15.00 USD x 0.92 = 13.80 EUR
- Pending: 85.00 USD x 0.92 = 78.20 EUR
- admin_currency: EUR
- admin_total_amount: 92.00
- admin_paid_amount: 13.80
- admin_pending_amount: 78.20

Vendor snapshot (internal vehicles only)
- Uses vendor default currency.
- If GreenMotion is external, vendor amounts are not used.

4) Provider reservation (GreenMotion API)
MakeReservation sends provider currency (USD) values:
- vehicle_total: 100.00 USD
- grand_total: 100.00 USD
- payment_type: POA
- options: extras in USD
- customer details + quoteid

5) Notifications (currency per recipient)

Customer / Guest
- Currency: INR
- Amounts: total 8300.00, paid 1245.00, pending 7055.00

Admin
- Currency: EUR
- Amounts: total 92.00, paid 13.80, pending 78.20
- Fallback: booking currency amounts from bookings if booking_amounts missing

Vendor (internal only)
- Currency: vendor default
- Amounts: vendor snapshot
- Fallback: booking currency if vendor snapshot missing

Provider
- No email; provider receives MakeReservation payload in USD
