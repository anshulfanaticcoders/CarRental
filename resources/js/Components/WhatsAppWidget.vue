<template>
  <div class="fixed bottom-6 right-6 z-50">
    <button
      @click="togglePopup"
      class="bg-green-500 hover:bg-green-600 p-4 rounded-full shadow-lg flex items-center justify-center"
    >
      <svg class="w-6 h-6 text-white" viewBox="0 0 32 32">
        <path
          fill="currentColor"
          d="M16.003 2.002c-7.732 0-14 6.268-14 14 0 2.47.675 4.906 1.96 7.05L2 30l7.134-1.92A13.964 13.964 0 0 0 16 30c7.732 0 14-6.268 14-14s-6.268-14-14-14Zm0 2c6.627 0 12 5.373 12 12s-5.373 12-12 12c-2.22 0-4.402-.607-6.3-1.758l-.437-.26-4.463 1.201 1.208-4.366-.284-.448A11.964 11.964 0 0 1 4 16c0-6.627 5.373-12 12-12Zm5.725 6.263c-.33-.729-.674-.747-.99-.76-.257-.012-.552-.012-.846-.012s-.78.112-1.19.56c-.41.448-1.57 1.54-1.57 3.75s1.61 4.35 1.835 4.65c.224.3 3.09 4.96 7.62 6.75.876.3 1.56.48 2.09.612.875.224 1.67.193 2.3.118.7-.088 2.16-.876 2.46-1.73.302-.86.302-1.6.214-1.73-.088-.12-.33-.193-.69-.336s-2.16-1.07-2.495-1.194c-.334-.123-.576-.186-.82.123-.244.31-.946 1.194-1.16 1.437-.214.244-.42.274-.774.15-.354-.123-1.49-.548-2.83-1.75-1.046-.933-1.75-2.08-1.96-2.435-.214-.354-.024-.53.18-.713.18-.165.354-.37.53-.56.176-.188.354-.39.52-.61.176-.22.33-.44.502-.62.176-.178.37-.36.582-.51.208-.153.408-.24.623-.183.214.06 1.39.655 1.95.93.558.275 1.064.513 1.52.75.456.235.91.47 1.47.734.56.262 1.26.636 1.69.826.434.19.866.35 1.287.51.42.16.83.31 1.23.44.398.133.794.26 1.186.374.392.116.784.226 1.17.33.388.105.774.21 1.156.314.38.104.758.21 1.132.314.376.106.75.21 1.12.316.368.107.738.213 1.1.32.364.107.725.213 1.082.32.357.107.716.21 1.07.316.353.105.708.21 1.058.316.348.106.7.212 1.044.318.345.106.693.21 1.036.314.343.105.688.21 1.03.315.34.105.683.21 1.023.316.34.106.68.21 1.02.316.336.106.67.21 1.004.316.33.107.662.21.992.316.33.106.662.21.99.315.324.107.65.21.97.316.322.106.648.21.968.316.318.107.64.21.954.316.316.106.636.21.95.316.312.107.628.21.936.316.31.106.62.21.93.316.31.106.622.21.93.316.308.106.618.21.926.316.308.106.616.21.922.316.308.107.616.21.92.316.308.106.616.21.92.316.306.106.614.21.918.316.306.106.612.21.918.316.306.107.61.21.916.316.306.106.61.21.914.316.306.106.61.21.914.316.306.106.61.21.914.316.306.106.61.21.914.316.306.106.61.21.914.316.306.106.61.21.914.316.306.106.61.21.914.316.306.106.61.21.914.316.306.106.61.21.914.316.306.106.61.21.914.316.306.106.61.21.914.316.306.106.61.21.914.316.306.106.61.21.914.316.306.106.61.21.914.316.306.106.61.21.914.316z"
        />
      </svg>
    </button>

    <!-- Popup -->
    <div
      v-if="showPopup"
      class="bg-white shadow-lg rounded-lg p-4 mt-2 w-72"
    >
      <textarea
        v-model="message"
        placeholder="Type your message..."
        class="w-full border border-gray-300 rounded p-2 mb-2"
        rows="3"
      ></textarea>
      <button
        @click="sendMessage"
        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded w-full"
      >
        Send via WhatsApp
      </button>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import axios from 'axios'

const showPopup = ref(false)
const message = ref('')

function togglePopup() {
  showPopup.value = !showPopup.value
}

async function sendMessage() {
  if (!message.value.trim()) return alert('Please enter a message.')

  try {
    await axios.post('/api/send-whatsapp-message', {
      message: message.value,
    })
    message.value = ''
    showPopup.value = false
  } catch (error) {
    console.error(error)
  }
}
</script>
